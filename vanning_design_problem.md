# バンニングレイアウト設計

## 1. 目的

与えられた直方体箱（A/B/Cの3種類、各箱ごとに重量が異なる）を20フィートコンテナに積み付ける。

- 主目的：使用するコンテナ本数を最小化する。
- 副目的（同本数のとき）：各コンテナの重心（水平投影）が底面中心から半径30cm以内に収まるようにしつつ、その余裕（中心からの距離）を小さくする。

本課題は「3Dパッキング + 最大積載重量 + 重心制約（バランス）」の近似最適化を想定しています。


## 2. コンテナ仕様（20ft）

- 内寸（内側の有効寸法）
- 長さ L = 5,898 mm
- 幅 W = 2,352 mm
- 高さ H = 2,393 mm
- 最大積載重量（ペイロード）：12,000 kg

座標系：

- 原点：コンテナ内側の手前左下（床面の角）。※「手前」はドア（開口部）側、奥はコンテナの前壁側とする。
- x：長さ方向（0〜L）
- y：幅方向（0〜W）
- z：高さ方向（0〜H）
- 床面中心：((X_c, Y_c) = (L/2, W/2))


## 3. 箱仕様（A/B/C）

すべて直方体。天地（上下）は固定。

- 許可する向き（水平回転）：
- 0° または 90° のみ（長さ×幅の入れ替えは可、高さは固定）

箱の外形寸法（mm）：

- A：1,400 × 1,000 × 800（高さ 800）
- B：1,200 × 900 × 700（高さ 700）
- C： 800 × 600 × 600（高さ 600）


## 4. 制約条件

### 4.1 収容・非重なり

各箱は、割り当てられたコンテナ内に完全に収まること。

- 箱は座標軸に平行（傾けない）
- 箱同士は重なってはいけない（内部交差なし）

### 4.2 行先（配送先）制約

各コンテナ内には、同一の行先を持つ箱のみを積載できる（行先が異なる箱を同一コンテナに混載してはならない）。

### 4.3 積載重量

各コンテナごとに、割り当てられた箱の重量合計が

- 12,000 kg 以下

### 4.4 “置き方”の簡易安定条件（実装しやすいルール）

以下のどちらかで置くこと：


- 床置き：z = 0


- 単一箱の上に載せる：
- ある箱 j の上面（z = 上面高さ）に、別の箱 i を載せてよい
- ただし箱 i の底面矩形は、箱 j の上面矩形の内側に完全に収まること（跨ぎ禁止）

これにより「空中に浮く」「複数箱にまたがる」などを禁止し、層（レイヤ）法や極点法で扱いやすくします。

### 4.5 重心制約（水平投影が中心から半径30cm以内）

各コンテナごとに、割り当てられた箱の重心（水平投影）が

- 床面中心 ((X_c, Y_c)) から 半径 300mm 以内

箱 i の中心座標を ((x_i, y_i, z_i))、重量を (w_i) とすると、水平重心は：

- (x̄ = (Σ_i w_i x_i) / (Σ_i w_i))
- (ȳ = (Σ_i w_i y_i) / (Σ_i w_i))

制約：

- (x̄ - X_c)^2 + (ȳ - Y_c)^2 ≤ 300^2

箱中心座標の計算（配置が左下手前角 ((x^{pos}, y^{pos}, z^{pos})) のとき）：

- (x_i = x^{pos} + l_i/2)
- (y_i = y^{pos} + w_i/2)
- (z_i = z^{pos} + h_i/2)

ここで (l_i, w_i, h_i) は箱 i の（長さ, 幅, 高さ）で、向きが 0° のとき (l_i, w_i) = (長辺, 短辺)、90° のとき (l_i, w_i) = (短辺, 長辺) とする。


## 5. 目的関数（評価）

### 5.1 一次目的

- 使用コンテナ本数 N を最小化

### 5.2 タイブレーク（同じ N の場合）

以下を順に比較：

- 最悪コンテナの重心距離 \(\max_k d_k\) を最小化（小さいほど良い）
- \(d_k = \sqrt{(\bar{x}_k - X_c)^2 + (\bar{y}_k - Y_c)^2}\)
- 総空き体積（2D/3Dの厳密計算が難しい場合は、箱体積合計での「充填率」でも可）


## 6. 提出物（印刷して採点できる形式）

- 使用コンテナ本数 N
- 各コンテナの
- 割り当て箱ID一覧
- 総重量
- 箱ID / 種類 / 重量(kg) / 行先
- レイアウト表（箱ごと）：
- 箱ID / 種類 / 重量(kg)
- コンテナ番号
- 向き（0° or 90°）
- 配置（左下手前角＝ドア側左下の床角からの座標）((x^{pos}, y^{pos}, z^{pos})) [mm]


## 7. 入力データ（今回の問題インスタンス）

### 7.1 箱一覧（合計80箱）

- A：30箱（A01〜A30）
- B：30箱（B01〜B30）
- C：20箱（C01〜C20）

※各箱には行先 Dest が付与され、Dest は "X" または "Y" のいずれかで与えられます。

※寸法は種類で固定、重量は箱ごとに異なります。

### 7.2 重量データ（kg）

#### A（1,400×1,000×800）

| ID | 重量 | ID | 重量 | ID | 重量 |
| --- | --- | --- | --- | --- | --- |
| A01 | 420 | A11 | 260 | A21 | 320 |
| A02 | 380 | A12 | 440 | A22 | 295 |
| A03 | 310 | A13 | 355 | A23 | 430 |
| A04 | 450 | A14 | 300 | A24 | 305 |
| A05 | 275 | A15 | 395 | A25 | 280 |
| A06 | 360 | A16 | 285 | A26 | 370 |
| A07 | 330 | A17 | 410 | A27 | 335 |
| A08 | 290 | A18 | 340 | A28 | 255 |
| A09 | 405 | A19 | 270 | A29 | 390 |
| A10 | 315 | A20 | 365 | A30 | 345 |

#### B（1,200×900×700）

| ID | 重量 | ID | 重量 | ID | 重量 |
| --- | --- | --- | --- | --- | --- |
| B01 | 260 | B11 | 250 | B21 | 215 |
| B02 | 240 | B12 | 210 | B22 | 290 |
| B03 | 310 | B13 | 285 | B23 | 230 |
| B04 | 180 | B14 | 235 | B24 | 340 |
| B05 | 205 | B15 | 320 | B25 | 185 |
| B06 | 295 | B16 | 175 | B26 | 275 |
| B07 | 225 | B17 | 265 | B27 | 220 |
| B08 | 270 | B18 | 200 | B28 | 315 |
| B09 | 190 | B19 | 305 | B29 | 255 |
| B10 | 330 | B20 | 245 | B30 | 195 |

#### C（800×600×600）

| ID | 重量 | ID | 重量 | ID | 重量 | ID | 重量 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| C01 | 150 | C06 | 160 | C11 | 140 | C16 | 85 |
| C02 | 120 | C07 | 130 | C12 | 115 | C17 | 155 |
| C03 | 180 | C08 | 170 | C13 | 165 | C18 | 105 |
| C04 | 90 | C09 | 100 | C14 | 125 | C19 | 175 |
| C05 | 110 | C10 | 190 | C15 | 200 | C20 | 135 |



### 7.3 行先データ（X/Y）

以下に各箱の行先 Dest（"X" または "Y"）を示します。

| 箱ID | 行先 Dest |
| --- | --- |
| A01 | X |
| A02 | X |
| A03 | X |
| A04 | X |
| A05 | X |
| A06 | X |
| A07 | X |
| A08 | X |
| A09 | X |
| A10 | X |
| A11 | X |
| A12 | X |
| A13 | X |
| A14 | X |
| A15 | X |
| A16 | Y |
| A17 | Y |
| A18 | Y |
| A19 | Y |
| A20 | Y |
| A21 | Y |
| A22 | Y |
| A23 | Y |
| A24 | Y |
| A25 | Y |
| A26 | Y |
| A27 | Y |
| A28 | Y |
| A29 | Y |
| A30 | Y |
| B01 | X |
| B02 | X |
| B03 | X |
| B04 | X |
| B05 | X |
| B06 | X |
| B07 | X |
| B08 | X |
| B09 | X |
| B10 | X |
| B11 | X |
| B12 | X |
| B13 | X |
| B14 | X |
| B15 | X |
| B16 | Y |
| B17 | Y |
| B18 | Y |
| B19 | Y |
| B20 | Y |
| B21 | Y |
| B22 | Y |
| B23 | Y |
| B24 | Y |
| B25 | Y |
| B26 | Y |
| B27 | Y |
| B28 | Y |
| B29 | Y |
| B30 | Y |
| C01 | X |
| C02 | X |
| C03 | X |
| C04 | X |
| C05 | X |
| C06 | X |
| C07 | X |
| C08 | X |
| C09 | X |
| C10 | X |
| C11 | Y |
| C12 | Y |
| C13 | Y |
| C14 | Y |
| C15 | Y |
| C16 | Y |
| C17 | Y |
| C18 | Y |
| C19 | Y |
| C20 | Y |
